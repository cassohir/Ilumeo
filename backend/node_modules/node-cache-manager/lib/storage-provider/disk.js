'use strict';Object.defineProperty(exports,'__esModule',{value:!0});var _fs=require('fs'),_fs2=_interopRequireDefault(_fs),_path=require('path'),_path2=_interopRequireDefault(_path),_util=require('util');function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}var writeFileAsync=(0,_util.promisify)(_fs2.default.writeFile),readFileAsync=(0,_util.promisify)(_fs2.default.readFile),accessFileAsync=(0,_util.promisify)(_fs2.default.access),storagePath=_path2.default.resolve(__dirname,'..','..','.cache'),defaultStoragePath=_path2.default.resolve(storagePath,'default.json'),presist=async function(a,b){return writeFileAsync(a,JSON.stringify(b))},presistSync=function(a,b){return _fs2.default.writeFileSync(a,JSON.stringify(b))},exists=async function(a){try{return await accessFileAsync(a),!0}catch(a){return!1}},existsSync=function(a){try{return _fs2.default.accessSync(a,_fs2.default.constants.F_OK),!0}catch(a){return!1}},updateStore=async function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:'',b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};if(a){var c=_path2.default.resolve(storagePath,a+'.json'),d=await exists(c);if(d){var e=await presist(c,b);return e}throw new Error('Store '+a+', doesn\'t exists')}else{var f=await presist(defaultStoragePath,b);return f}},updateStoreSync=function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:'',b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};if(a){var c=_path2.default.resolve(storagePath,a+'.json'),d=exists(c);if(d){var e=presistSync(c,b);return e}throw new Error('Store '+a+', doesn\'t exists')}else{var f=presistSync(defaultStoragePath,b);return f}},clear=async function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:'';return updateStore(a,{})},clearSync=function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:'';return updateStoreSync(a,{})},store=async function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:'';if(a){var b=_path2.default.resolve(storagePath,a+'.json'),c=await exists(b);if(exists(c)){var e=await readFileAsync(b,'utf8');return e?JSON.parse(e):{}}return await presist(b,{}),{}}var d=await readFileAsync(defaultStoragePath,'utf8');return d?JSON.parse(d):{}},storeSync=function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:'';if(a){var b=_path2.default.resolve(storagePath,a+'.json'),c=existsSync(b);if(c){var e=_fs2.default.readFileSync(b,'utf8');return e?JSON.parse(e):{}}return presistSync(b,{}),{}}var d=_fs2.default.readFileSync(defaultStoragePath,'utf8');return d?JSON.parse(d):{}},StorageProvider={updateStore:updateStore,clear:clear,store:store,updateStoreSync:updateStoreSync,clearSync:clearSync,storeSync:storeSync};exports.default=StorageProvider;